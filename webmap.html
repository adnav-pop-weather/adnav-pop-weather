<html>
    <head>
        <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
        <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />
    </head>
    <body>
        <div id='map' style='width: 100%; height: 100%;'></div>
        <script>
            let map = new maplibregl.Map({
            container: 'map',
            style: 'https://api.maptiler.com/maps/openstreetmap/style.json?key=B4aXfeirwaNRuIpLUBUC', // stylesheet location
            center: [-96.8378912, 32.805745], // starting position [lng, lat]
            zoom: 13 // starting zoom
            });

            // const data_path = 'http://localhost:5500/pop_tiles_13_14/{z}/{x}/{y}.pbf'
            // const demo1MartinUrl = `http://localhost:3000/pop_tiles`
            /*
                Need to start Martin Tileserver in the directory first, with the following command:
                martin ./filename
                It will bind to port 3000, so the URL is shown below. Also this example is for a .mbtiles file.
                Martin is meant to be configured to serve tiles from a postgis database, maybe we will look
                into that to generate tiles on the fly from our data.
            */
            const demo2MartinUrl = `http://localhost:3000/full_pop_tiles`
            map.on('load', () => {
                // add the population mbtiles
                map.addSource('population', {
                    type: 'vector',
                    url: demo2MartinUrl,
                    minzoom: 0,
                    maxzoom: 14
                });
                /*
                layers for demo 1 .mbtiles file. 7 layers for 7 joined input .mbtiles
                const layers = ['population_4326_z13',
                    'population_4326_z11',
                    'population_4326_z9',
                    'population_4326_z7',
                    'population_4326_z4',
                    'population_4326_z2',
                    'population_4326_z0']

                 */
                const demo2Layers = ['population_4326']
                demo2Layers.forEach((sourceLayer, index) => {
                    map.addLayer({
                        'id': 'population_data' + index.toString(),
                        'type': 'fill',
                        'source': 'population', // same as addSource argument.
                        'source-layer': sourceLayer,
                        'paint': {
                            /* values for pop distribution are as follows:
                                0 >= x1 > 7,
                                 7 >= x2 > 39,
                                 39 >= x3 > 240,
                                 240 >= x4 > 1490,
                                 1490 >= x5 > 9257.
                            */

                            'fill-color': [
                                'interpolate',
                                ['linear'],
                                ['get', 'population'],
                                0, '#000004',
                                7, '#51127c',
                                39, '#b73779',
                                240, '#fc8961',
                                1490, '#fcfdbf'
                            ],
                            //'fill-color': "#E580A2",
                            'fill-opacity': 0.5,
                            'fill-outline-color': "#000000"
                        }
                    });
                });
            });
        </script>
    </body>
</html>


